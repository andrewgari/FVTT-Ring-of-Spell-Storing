#!/bin/bash

# Ring of Spell Storing - Pre-commit Hook
# This hook runs ESLint on JavaScript files before commit

echo "üîç Running pre-commit checks for Ring of Spell Storing..."

# Check if ESLint is available
if ! command -v npx &> /dev/null; then
    echo "‚ö†Ô∏è  npx not found. Please install Node.js and npm."
    echo "   You can still commit, but linting is recommended."
    exit 0
fi

# Check if node_modules exists
if [ ! -d "node_modules" ]; then
    echo "üì¶ Installing dependencies..."
    npm install
fi

# Get list of staged JavaScript files
STAGED_JS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js)$')

if [ -z "$STAGED_JS_FILES" ]; then
    echo "‚úÖ No JavaScript files to lint."
    exit 0
fi

echo "üîç Linting JavaScript files..."
echo "$STAGED_JS_FILES"

# Run ESLint on staged files
npx eslint $STAGED_JS_FILES

ESLINT_EXIT_CODE=$?

if [ $ESLINT_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "‚ùå ESLint found issues in your JavaScript files."
    echo "   Please fix the issues above before committing."
    echo "   You can run 'npm run lint:fix' to auto-fix some issues."
    echo ""
    echo "   To bypass this check (not recommended), use:"
    echo "   git commit --no-verify"
    exit 1
fi

echo "‚úÖ All JavaScript files passed linting!"
echo "üéâ Ready to commit!"

exit 0
